{% extends 'taxi_posts/base.html' %}
{% load static %}

{% block main_area %}
<br><br>
<section class="title" style="top: -170px; transform: none;">
    <div class="wrap">
        <p class="badges">
            <span>{{ contest.contest_category }}</span>
        </p>
        {% if contest.contest_image %}
            <img src="{{ contest.contest_image.url }}" alt="Contest Image">
        {% else %}
            <img src="https://picsum.photos/seed/{{ contest.id }}/800/200" class="card-img-top" alt="random_image">
        {% endif %}
        <div class="content">
            <h1 style="font-size: 20px;">{{ contest.contest_title }}</h1>
            <p class="info">
                <span class="viewcount" style="font-size: 15px;">
                    <span class="material-symbols-outlined" style="font-size: 13px; padding-top: 6px;">
                        visibility
                    </span>
                    {{ contest.contest_view_count }}
                </span>
            </p>
            <a class="scrap">
                <form method="post" action="{% url 'comment' contest.id %}" id="scrapForm">
                    {% csrf_token %}
                    <button type="submit" name="scrap" onclick="handleScrap(event)">
                        <span class="material-symbols-outlined" style="background-color: white; font-size: 28px;">
                            bookmark
                        </span>
                    </button>
                </form>
            </a>
        </div>
    </div>
</section>

<section class="tab">
    <div class="wrap">
        <a href="{% url 'contest_detail' contest.id %}">
            <span class="text">소개</span>
        </a>
        <a href="{% url 'list_contest' contest.id %}">
            <span class="text">팀원 모집</span>
            <span class="count">{{ contest.prj_set.count }}</span>
        </a>
        <a href="{% url 'comment' contest.id %}" data-menu="comment" class="active">
            <span class="text">댓글</span>
            <span class="commentcount">{{ comments.count }}</span>
        </a>
    </div>
</section>

<div class="container">
    <div class="comments">
        <h4>댓글:</h4>
        {% for comment in comments %}
            <div class="comment">
                <p>{{ comment.comment }} - {{ comment.created_at }} - {{ user.username }}</p>
            </div>
        {% endfor %}
    </div>

    <div class="comment-form">
        <form method="post" action="{% url 'comment' contest.id %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="comment">댓글:</label>
                <textarea class="form-control" id="comment" name="comment" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</div>

<style>
    section.title > div.wrap > div.content > p.info > span {
        display: inline-block;
        margin-right: 8px;
        line-height: 18px;
        color: #a6a6a6;
        font-size: 12px;
        letter-spacing: 0;
    }

    .comments {
        margin-top: 20px;
    }

    .comment {
        margin-bottom: 10px;
    }

    .comment-form {
        margin-top: 20px;
    }
    section.tab > div.wrap > a > span.count {
        margin-left: 4px;
        color: #a6a6a6;
        font-size: 10px;
        font-weight: bold;
        letter-spacing: 0;
    }
    span.commentcount {
        margin-left: 4px;
        color: #a6a6a6;
        font-size: 12px;
        font-weight: bold;
        letter-spacing: 0;
    }
</style>
<script>
    function handleScrap(event) {
        jQuery.ajax({
            url: "{% url 'scrap_contest' contest.id %}",
            method: "POST",
            data: { csrfmiddlewaretoken: '{{ csrf_token }}', contest_id: {{ contest.id }} },
            success: function (data) {
                console.log(data);
                alert(data.message);
                if (data.status === 'success') {
                    // 추가 작업
                }
            },
            error: function (error) {
                console.log(error);
            },
        });
    }
</script>

<link rel="stylesheet" type="text/css" href="{% static 'contest/css/detail.css' %}">

{% endblock %}
