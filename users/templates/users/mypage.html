{% extends 'taxi_posts/base.html' %}
{% load static %}

{% block main_area %}
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<link rel="stylesheet" type="text/css" href="{% static 'contest/css/list.css' %}">
<br><br><br><br><br><br><br><br>
  <h2>Your Scraped Contests</h2>
  {% for contest in saved_posts %}

  <div class="row mb-2">
    <div class="col-md-6">
      <a class="top" href="{% url 'contest_detail' contest.id %}">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-primary-emphasis">
              <p class="badges">
                <span>{{ contest.contest_category }}</span>
              </p>
            </strong>
            <h3 class="mb-0">{{ contest.contest_title }}</h3>
            <span class="mb-1 text-body-secondary {% if contest.deadline < 0 %}highlight{% endif %}">
              {% if contest.deadline >= 0 %}
                D-{{ contest.deadline }}
              {% else %}
                <p style="color:#8B2845">마감</p>
              {% endif %}
            </span>
            <p class="card-text mb-auto">This is a wider card with supporting text below as a natural lead-in to additional content.</p>
            <a href="https://getbootstrap.com/docs/5.3/examples/blog/#" class="icon-link gap-1 icon-link-hover stretched-link">
              Continue reading
              <svg class="bi"><use xlink:href="#chevron-right"></use></svg>
            </a>
          </div>
        </div>
      </a>
    </div>
  {% endfor %}
  {% if not saved_posts %}
    <p>You haven't scraped any contests yet.</p>
  {% endif %}

  <div class="card text-center">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">
          <a class="nav-link active" href="#">전체</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">공모전/프로젝트</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">스터디</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">카풀</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">OTT</a>
        </li>
      </ul>
    </div>

    <div class="card-body">
      {% for post in user_posts %}
        <div class="card text-start">
            <div class="card-header">
              {{ post.category }}
            </div>
            <div class="card-body">
              <h5 class="card-title">{{ post.title }}</h5>
              <p class="card-text">{{ post.content }}</p>
              <a href="#" class="btn btn-primary">수정</a>
              <a href="#" class="btn btn-primary">삭제</a>
            </div>
        </div>
      {% endfor %}

      {% if not user_posts %}
        <p>You haven't written any posts yet.</p>
      {% endif %}
    </div>
  </div>

<style>
  .card-header .nav-link {
    color: black !important;
  }
  .card-header .nav-link.active {
    color: blue !important;
  }
</style>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script>
    $(document).ready(function(){
        $('.card-header .nav-link').click(function(e){
            e.preventDefault();
            $('.card-header .nav-link').removeClass('active');
            $(this).addClass('active');
            

            var category = $(this).text().trim();

            $.ajax({
                type: 'GET',
                url: '/get_posts_by_category/',
                data: {'category': category},
                success: function(data){
                    updatePosts(data.posts);
                },
                error: function(error){
                    console.log(error);
                }
            });
        });

        function updatePosts(posts) {
            // 사용자가 작성한 글을 동적으로 업데이트
            var cardBody = $('.card-body');
            cardBody.empty();  // 기존 내용 비우기

            if (posts.length > 0) {
                for (var i = 0; i < posts.length; i++) {
                    var post = posts[i];
                    var cardHtml = `
                        <div class="card text-start">
                            <div class="card-header">
                                ${post.category}
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">${post.title}</h5>
                                <p class="card-text">${post.content}</p>
                                <a href="#" class="btn btn-primary">수정</a>
                                <a href="#" class="btn btn-primary">삭제</a>
                            </div>
                        </div>
                    `;
                    cardBody.append(cardHtml);
                }
            }
            else {
                cardBody.html('<p>No posts in this category.</p>');
            }
        } 
    });
</script>

{% endblock %}
